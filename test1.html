<!DOCTYPE html>
<html>
<head>
    <title>js实现textarea选中文字并加粗</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Language" content="zh-CN" />
</head>
<body>
<div id="input" contenteditable>I <b>look</b> like an input</div>
<!--<textarea id="content" cols="50" rows="5">AAAAAAA BBBBBBB AAAAAAA CCCCCCC</textarea>-->
<input type="button" id="bold" value="B"/>
<script type="text/javascript">
    var selectionStart, selectionEnd;
    var isTagged = false;
    var textarea = document.getElementById("input");

    document.onkeyup = document.onmouseup = function(event){
        event = event || window.event;
        // var keyCode = event.keyCode || event.which;

        var userSelection;
        if (window.getSelection) { //Chrome
            userSelection = window.getSelection();
        } else if (document.selection) { //IE && Opera
            userSelection = document.selection.createRange();
        }

        var getRangeIndex = function(selectionObject) {
            if (selectionObject) {
                var index1 = selectionObject.anchorOffset;
                var index2 = selectionObject.focusOffset;
                // console.log(selectionObject.focusNode);
                if (index1>index2)
                    return [selectionObject.focusOffset, selectionObject.anchorOffset];
                    else return [selectionObject.anchorOffset, selectionObject.focusOffset];
            }
        };
        var rangeIndex = getRangeIndex(userSelection);

        console.log(textarea.innerText);
        console.log(userSelection.focusNode.parentElement.tagName);
        console.log(userSelection.focusNode.parentElement.tagName === 'B');
        selectionStart = rangeIndex[0];
        selectionEnd   = rangeIndex[1];
        console.log(selectionStart, selectionEnd);
        if (userSelection.anchorNode === textarea) {
            isTagged = false;
        } else {
            isTagged = true;
        }
    };



    //Bold
    document.getElementById('bold').onclick = function(){
        // if
        // if (isTagged) {
        //     document.getElementById('bold').style.backgroundColor = "#2789b3";
        // } else {
        //     document.getElementById('bold').style.backgroundColor = "#FAFAFA";
        // }
        // if (userSelection.focusNode.parentElement )
        console.log(textarea.value);
        textarea.innerHTML = textarea.innerHTML.substring(0, selectionStart)
            + '<b>' + textarea.innerHTML.substring(selectionStart, selectionEnd)
            + '</b>' + textarea.innerHTML.substring(selectionEnd);
        // console.log(textarea.innerHTML);
    };

    // document.getElementById('bold').onclick = function(){
    //     textarea.innerHTML = textarea.innerHTML.substring(0, selectionStart)
    //         + '<b>' + textarea.innerHTML.substring(selectionStart, selectionEnd)
    //         + '</b>' + textarea.innerHTML.substring(selectionEnd);
    //     // console.log(textarea.innerHTML);
    // };

</script>
</body>
</html>